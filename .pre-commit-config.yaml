repos:
  - repo: local
    hooks:
      # Pre-commit: fast auto-formatting
      # Auto-fixes formatting and re-stages changed files
      - id: cargo-fmt
        name: cargo fmt (auto-fix)
        entry: bash -c 'set -e; cargo fmt --all && git add -u'
        language: system
        types: [rust]
        pass_filenames: false
        stages: [pre-commit]
        always_run: false

      # Pre-push: full validation
      # Verifies formatting hasn't regressed (safety check)
      - id: cargo-fmt-check
        name: cargo fmt --check
        entry: bash -c 'set -e; cargo fmt --all -- --check'
        language: system
        types: [rust]
        pass_filenames: false
        stages: [pre-push]
        always_run: false

      # Pre-push: linting with strict warnings
      # Fails if clippy finds issues (user must fix manually)
      - id: cargo-clippy
        name: cargo clippy (strict)
        entry: bash -c 'set -e; cargo clippy --all-features --all-targets -- -D warnings -A dead_code'
        language: system
        types: [rust]
        pass_filenames: false
        stages: [pre-push]
        always_run: false

      # Pre-push: run tests with nextest
      # Ensures code passes all tests before pushing
      # Uses nextest for faster parallel execution and better output
      - id: cargo-nextest
        name: cargo nextest run
        entry: bash -c 'set -e; cargo nextest run --all-features --profile pre-push'
        language: system
        types: [rust]
        pass_filenames: false
        stages: [pre-push]
        always_run: false
